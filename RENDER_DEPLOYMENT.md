# üöÄ Render Deployment Guide for Django Car Rental API

## üìã Prerequisites

1. **GitHub Repository**: Your code should be pushed to GitHub
2. **Render Account**: Sign up at [render.com](https://render.com)
3. **Environment Variables**: Prepare your production environment variables

## üõ†Ô∏è Deployment Steps

### 1. **Prepare Your Repository**

Make sure these files are in your repository root:
- `render.yaml` ‚úÖ
- `Dockerfile.render` ‚úÖ
- `render-entrypoint.sh` ‚úÖ
- `requirements-render.txt` ‚úÖ
- `car_rental/settings/render.py` ‚úÖ

### 2. **Deploy to Render**

#### Option A: Using render.yaml + Docker (Recommended)
1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click "New +" ‚Üí "Blueprint"
3. Connect your GitHub repository
4. Render will automatically detect `render.yaml`, build `Dockerfile.render`, and deploy the web, Postgres, and Redis services

#### Option B: Manual Web Service Setup
1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click "New +" ‚Üí "Web Service"
3. Connect your GitHub repository
4. Choose **Environment ‚Üí Docker**
5. Set **Dockerfile path** to `Dockerfile.render`
6. (No start command needed ‚Äî Docker CMD already runs `render-entrypoint.sh`)
7. Add the environment variables below (or sync them from `render.yaml`)

`render-entrypoint.sh` handles:
- database availability checks
- enabling the PostGIS extension
- running migrations and `collectstatic`
- creating the default admin user (optional)
- starting Gunicorn

**Environment Variables:**
```
DJANGO_SETTINGS_MODULE=car_rental.settings.render
SECRET_KEY=your-secret-key-here
DEBUG=False
ALLOWED_HOSTS=your-app-name.onrender.com
POSTGRES_DB=your-db-name
POSTGRES_USER=your-db-user
POSTGRES_PASSWORD=your-db-password
POSTGRES_HOST=your-db-host
POSTGRES_PORT=5432
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
REDIS_URL=your-redis-url
```

### 3. **Create Database**

1. Go to "New +" ‚Üí "PostgreSQL"
2. Choose "Free" plan
3. Note down the connection details
4. Update your environment variables with these details

### 4. **Create Redis (Optional)**

1. Go to "New +" ‚Üí "Redis"
2. Choose "Free" plan
3. Note down the connection string
4. Update `REDIS_URL` environment variable

## üîß Configuration Files

### render.yaml
```yaml
databases:
  - name: django-car-rental-db
    plan: free
    ipAllowList: []

services:
  - type: web
    name: django-car-rental-api
    env: docker
    plan: free
    dockerfilePath: Dockerfile.render
    envVars:
      - key: DJANGO_SETTINGS_MODULE
        value: car_rental.settings.render
      # ... other environment variables

  - type: redis
    name: django-car-rental-redis
    plan: free
```

### render-entrypoint.sh
```bash
#!/usr/bin/env bash
set -o errexit
set -o pipefail

python manage.py shell -c "from django.db import connection; cursor = connection.cursor(); cursor.execute('CREATE EXTENSION IF NOT EXISTS postgis');"
python manage.py migrate --noinput
python manage.py collectstatic --noinput

# Create default admin user
python manage.py shell -c "
from django.contrib.auth import get_user_model
User = get_user_model()
if not User.objects.filter(email='admin@admin.com').exists():
    User.objects.create_superuser(
        email='admin@admin.com',
        username='admin',
        password='admin123'
    )
"

exec gunicorn car_rental.wsgi:application --bind 0.0.0.0:${PORT:-8000}
```

## üåê Environment Variables

### Required Variables:
- `DJANGO_SETTINGS_MODULE`: `car_rental.settings.render`
- `SECRET_KEY`: Django secret key (auto-generated by Render)
- `DEBUG`: `False`
- `ALLOWED_HOSTS`: Your Render app URL
- `POSTGRES_*`: Database connection details

### Optional Variables:
- `EMAIL_*`: Email configuration
- `REDIS_URL`: Redis connection string
- `CORS_ALLOWED_ORIGINS`: Frontend domains

## üì± API Endpoints

Once deployed, your API will be available at:
```
https://your-app-name.onrender.com/api/
```

### Key Endpoints:
- **Authentication**: `/api/v1/auth/`
- **Cars**: `/api/cars/`
- **Bookings**: `/api/bookings/`
- **Users**: `/api/users/`
- **Location-based Search**: `/api/cars/nearby/`

## üîç Testing Your Deployment

### 1. Health Check
```bash
curl https://your-app-name.onrender.com/api/v1/auth/users/
```

### 2. Test Authentication
```bash
curl -X POST https://your-app-name.onrender.com/api/v1/auth/jwt/create/ \
  -H "Content-Type: application/json" \
  -d '{"email": "admin@admin.com", "password": "admin123"}'
```

### 3. Test Car Endpoints
```bash
curl https://your-app-name.onrender.com/api/cars/all/
```

## üö® Troubleshooting

### Common Issues:

1. **Build Fails**
   - Check `requirements-render.txt` for missing dependencies
   - Verify `build.sh` is executable
   - Check Render build logs

2. **Database Connection Issues**
   - Verify PostgreSQL service is running
   - Check environment variables
   - Ensure database credentials are correct

3. **Static Files Not Loading**
   - Run `python manage.py collectstatic --noinput`
   - Check `STATIC_ROOT` and `STATIC_URL` settings

4. **CORS Issues**
   - Update `CORS_ALLOWED_ORIGINS` in settings
   - Check frontend domain configuration

## üìä Monitoring

- **Logs**: Available in Render dashboard
- **Metrics**: CPU, Memory, Response time
- **Health Checks**: Automatic health monitoring

## üîÑ Updates

To update your deployment:
1. Push changes to GitHub
2. Render will automatically rebuild and redeploy
3. Check deployment logs for any issues

## üí° Tips

1. **Use Environment Variables**: Never hardcode sensitive data
2. **Monitor Logs**: Check Render logs for errors
3. **Test Locally**: Test with production settings locally first
4. **Backup Database**: Regular database backups
5. **SSL**: Render provides free SSL certificates

## üéØ Next Steps

1. Deploy your frontend to Render or another service
2. Update CORS settings for your frontend domain
3. Set up custom domain (optional)
4. Configure monitoring and alerts
5. Set up automated backups

---

**Happy Deploying! üöÄ**

